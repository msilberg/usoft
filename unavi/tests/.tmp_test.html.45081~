<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<script type="text/javascript" src="../js/jquery.min.js"></script>
<script type="text/javascript" src="../js/raphael.min.js"></script>
<script type="text/javascript" language="JavaScript">
	$(document).ready(function(){
		
		// --== Main Variables ==--
				
		var paper = Raphael(0,0,250,234);
		
		var sclCount = 0;
		var sclLim = 7;
		
		var flag0 = paper.rect(0,0,1,1);
		
		var objArr = new Array(
			paper.path("m 30.38587,15.905193 65.03518,0 0,65.453657 -65.03518,0 z"),
			paper.path("m 95.38948,15.872726 65.03519,0 0,65.453664 -65.03519,0 z"),
			paper.path("m 160.41472,15.872726 65.03519,0 0,65.453664 -65.03519,0 z"),
			paper.path("m 30.37506,81.35612 65.03518,0 0,65.45366 -65.03518,0 z"),
			paper.path("m 95.37868,81.32365 65.03519,0 0,65.45366 -65.03519,0 z"),
			paper.path("m 160.40392,81.32365 65.03519,0 0,65.45366 -65.03519,0 z"),
			paper.path("m 30.50131,146.76018 65.03518,0 0,65.45366 -65.03518,0 z"),
			paper.path("m 95.50495,146.72771 65.03518,0 0,65.45366 -65.03518,0 z"),
			paper.path("m 160.53017,146.72771 65.03519,0 0,65.45366 -65.03519,0 z")
		);
		var textArr = new Array(
			paper.text(62,49,"ak"),
			paper.text(128,49,"Ak"),
			paper.text(193,49,"Ak"),
			paper.text(62,114,"Bk"),
			paper.text(128,114,"Bk"),
			paper.text(193,114,"Bk"),
			paper.text(62,181,"Ck"),
			paper.text(128,181,"Ck"),
			paper.text(193,181,"Ck")
		);
		
		var step = 0.2;
		var vscale = 1;
		var fstep = 5;
		var fsize = 36;
		var x0, y0, dx, dy, dxt, dyt, xBegCurr, yBegCurr, xEndCurr, yEndCurr;
		var mw = 264;
		var mh = 213;
		var xBegInit = objArr[0].getBBox().x;
		var yBegInit = objArr[0].getBBox().y;
		var xEndInit = xBegInit + mw;
		var yEndInit = yBegInit + mh;
		var wd = false; // while dragging
		var txtOxCorr = .5;
		
		function getCurrCoords(){
			xBegCurr = objArr[0].getBBox().x
			yBegCurr = objArr[0].getBBox().y
			xEndCurr = xBegCurr + mw * vscale;
			yEndCurr = yBegCurr + mh * vscale;
		}
		function infoOtp(){
			//$("div.otp").text(xBegInit + " " + yBegInit + " | " + xBegCurr + " " + yBegCurr);
			$("div.otp").text(wd);
		}
		infoOtp();
		
		// ---=== The Scaling ===---
		function alignIt(){
			var xbstep, ybstep;
			
			if (sclCount == 0){
				xbstep = xBegCurr - xBegInit;
				ybstep = yBegCurr - yBegInit;
			}else{
				xbstep = (xBegCurr - xBegInit) / sclCount;
				ybstep = (yBegCurr - yBegInit) / sclCount;
			}
			xbstep *= (-1);
			ybstep *= (-1);
			for (var i = 0; i < objArr.length; i++){
				objArr[i].translate(xbstep, ybstep);
				textArr[i].translate(xbstep, ybstep);
			}
			getCurrCoords();
		}
		/*function txtOxCorr(i){
			if (textArr[i].charAt(0) == "A" || textArr[i].charAt(1) == "A" || textArr[i].charAt(2) == "A"){
				textArr[i].translate(.5,0);
			}
		}*/
		
		$("div.plus").click(function(){
			if (sclCount <= sclLim){
				vscale += step;
				fsize += fstep;
				for (var i = 0; i < objArr.length; i++){
					objArr[i].scale(vscale,vscale,vscale,vscale);
					textArr[i].scale(vscale,vscale,vscale,vscale);
					textArr[i].attr("font-size",fsize);
				}
				sclCount++;
				getCurrCoords();
				infoOtp();
			}
		});
		$("div.minus").click(function(){
			if (sclCount >= 1){
				vscale -= step;
				fsize -= fstep;
				for (var i = 0; i < objArr.length; i++) {
					objArr[i].scale(vscale,vscale,vscale,vscale);
					textArr[i].scale(vscale,vscale,vscale,vscale);
					textArr[i].attr("font-size",fsize);
					if (textArr[i].attr("text").charAt(0) == "A"){
						alert("est");
					}
				//	textArr[i].translate(txtOxCorr,0);
				}
				sclCount--;
				getCurrCoords();
				alignIt();
				infoOtp();
			}
		});
		
		// --== The Dragging ==--
		
		function moveIt(){
			for (var i = 0; i < objArr.length; i++){
				objArr[i].translate(dxt, dyt);
				textArr[i].translate(dxt, dyt);
			}
		}
		function stopIt(){
			for (var i = 0; i < objArr.length; i++){
				objArr[i].undrag();
				textArr[i].undrag();
			}
		}

		function objClick(){
			for (var i = 0; i < objArr.length; i++) {
				objArr[i].click(function(){
					setTimeout(function(){
						if (!wd){
							alert("you've clicked the Arr");
						}
					},200);
				});
				textArr[i].click(function(){
					setTimeout(function(){
						if (!wd){
							alert("you've clicked the Text");
						} 
					},200);
				});
			}
		}
		
		var start = function(){
			// storing original coordinates
			x0 = 0;
			y0 = 0;
		},
		move = function(dx,dy){
			// move will be called with dx and dy
			wd = true;			
			
			if (sclCount > 0){
				getCurrCoords();
				dxt = dx - x0;
				dyt = dy - y0;
				if (
					(xBegCurr >= xBegInit && dxt > 0) ||
					(yBegCurr >= yBegInit && dyt > 0) ||
					(xEndCurr <= xEndInit && dxt < 0) ||
					(yEndCurr <= yEndInit && dyt < 0) 
				){
					stopIt();	
				}else{
					moveIt();
				}
				x0 = dx;
				y0 = dy;
				infoOtp();
			}
		},
		up = function () {
			// restoring state
			setTimeout(function(){
				wd = false;
				infoOtp(); 
			},300);
		};
		
		for (var i = 0; i < objArr.length; i++){
			objArr[i].attr({"fill":"add8e6","stroke":"0086b2"});
			textArr[i].attr("font-size",fsize);
			objArr[i].drag(move, start, up);
			textArr[i].drag(move, start, up);
		}
		objClick();
	});
</script>
<style>
	.btn{
		display: block; 
		width: 150px;
		height: 70px;
		border: 1px solid #002b3a;
		background-color: #a1cedd;
		color: #002b3a;
		text-align: center;
	}
	.minus, .plus{
		font-size: 36pt;
	}
	table{
		position: relative; top: 520px; left: 0px;
	}
</style>
</head>
	<body>
		<table cellpadding="5" cellspacing="5">
			<tr>
				<td><div class="plus btn">+</div></td>
				<td><div class="minus btn">-</div></td>
				<td><div class="btn otp"></div></td>
			</tr>
		</table>
	</body>
</html>