var bVars={};var bMap={};var uServe={};var uBody={};uBody.langSwitcher=null;bVars.cat=null;bVars.store=null;bVars.divcbtnNo=null;bVars.prevBann=null;bVars.countSlide=0;bVars.slideStep=1118;bVars.ssCorr=4;bVars.slType=null;bVars.ssCorrVal=0;bVars.slideLimit=null;bVars.gsLimit=null;bVars.slideBegPos=null;bVars.slideEndPos=null;bVars.slBtnSlideBegPos=null;bVars.dragCrit=false;bVars.dragSlBtnCrit=false;bVars.allowClick=null;bVars.allowSlBtnClick=null;bVars.allowProtect=null;bVars.allowSlBtnProtect=null;bVars.ppMMBtnPass=null;bMap.varsArr=null;bVars.tLoadSlider=null;bVars.thSclHnt=null;bVars.tshSclHnt=null;bVars.ttglBtn=null;bVars.pmType=null;bVars.prevCountSlide=0;bVars.slBtnStepCount=0;bVars.moveLsBtnLimiter=false;bVars.rootScale=0;bVars.tbToRoot=null;bVars.bgThreshold=3;bVars.bgPointer=0;bVars.bgTail=0;bVars.specCat=[342];bVars.omSize={w:51,h:76};bVars.chmSize={w:56,h:89};bVars.catChmSize={w:56,h:89};bVars.flagSize={w:52,h:45};bVars.shcPnt=0;bVars.brwsPref=null;bVars.showTTS=true;bVars.singleTrailer=false;bVars.atClick=false;bVars.makeAtClickFalse=null;bVars.runScrs=null;bVars.runScrsQueue=null;bVars.startScrs=null;bVars.scrsRunInterval=95000;bVars.ocrLimiter=false;bVars.scrsStore=null;bVars.maxScale=4;bVars.zoomSup=10;bVars.somCrit=false;bVars.openOrigin=null;bVars.mIdArr=[];bVars.chsmIdArr=[];bVars.mArr=[];bVars.tMapMove=null;bMap.stCoords=[];bMap.chmCoords=[];bMap.ppCoords=[];bMap.path=null;var addrUrl={};addrUrl.base="http://uadmin.no-ip.biz/";addrUrl.startApi=addrUrl.base+"api.php";addrUrl.urlBckgr=addrUrl.base+"config/1003/mod/bismall.txt";addrUrl.api=addrUrl.startApi+"?query=";addrUrl.vapi=addrUrl.startApi+"?var=";addrUrl.markers=function(){var a=bMap.map.getExtent();return"http://uadmin.no-ip.biz:8080/geo?SERVICE=UniqoomAPI&REQUEST=milestone&TCID=1003&X1="+a.left+"&X2="+a.right+"&Y1="+a.bottom+"&Y2="+a.top+"&jsoncallback=?"};addrUrl.svapi=function(b,a){return addrUrl.startApi+"?setvar&name="+b+"&val="+a};addrUrl.loadBlock=function(a){return addrUrl.api+"1&block="+a};addrUrl.getLbl=function(a){return addrUrl.api+"2&lbl="+a};addrUrl.getStoreCat=function(a){return addrUrl.api+"8&sch="+a};addrUrl.checkFeature=function(b,a){return addrUrl.api+"17&store="+b+"&feat="+a};addrUrl.getSCName=function(a){return addrUrl.api+"4&cname="+a};addrUrl.getPrmSt=function(){return addrUrl.api+5};addrUrl.getSchId=function(){return addrUrl.api+6};addrUrl.getScatName=function(){return addrUrl.api+7};addrUrl.getJS=function(a){return addrUrl.base+"js/"+a+".js"};addrUrl.getFCatId=function(){return addrUrl.api+12};addrUrl.getIcon=function(a){return"url("+addrUrl.base+"graphics/icons/mod/"+a+".png)"};addrUrl.getStandBySt=function(){return addrUrl.api+23};addrUrl.getImage=function(b,a){if(!a){a="png"}return"url("+addrUrl.base+"graphics/"+b+"."+a+")"};addrUrl.getCImage=function(b,a){if(!a){a="png"}return addrUrl.base+"graphics/"+b+"."+a};addrUrl.getMCoords=function(){return addrUrl.api+19};addrUrl.getSi=function(a){return addrUrl.api+"24&sich="+a};uServe.arrayKeys=function(f,b,g){var d=new Array,g=!!g,a=true,c=0;for(key in f){a=true;if(b!=undefined){if(g&&f[key]!==b){a=false}else{if(f[key]!=b){a=false}}}if(a){d[c]=key;c++}}return d};uServe.arrayEnd=function(b){var a,c;if(b.constructor===Array){a=b[b.length-1]}else{for(c in b){a=b[c]}}return a};uServe.inArray=function(b,a){if($.inArray(b,a)==-1){return false}else{return true}};uServe.end=function(b){var a,c;if(b.constructor===Array){a=b[b.length-1]}else{for(c in b){a=b[c]}}return a};uServe.toggleMap=function(a){if(a){$("div#smap").show();$("div#scl-cnt").show();uServe.markerAboveBckgr()}else{$("div#smap").hide();$("div#scl-cnt").hide();uBody.toggleAddCbtn()}};uServe.toggleListBtn=function(a){if(bVars.showTTS&&a&&!$("div.show-st-list").is(":visible")){$("div.show-st-list").show()}else{if(!a&&$("div.show-st-list").is(":visible")){$("div.show-st-list").hide()}}};uServe.arrSub=function(b,a){var c=$.grep(b,function(d){return $.inArray(d,a)<0});return c};uServe.addNewMarker=function(m,x){var g,b,j,y,d,w;var v=[];var k=(new OpenLayers.LonLat(m.x,m.y)).transform(new OpenLayers.Projection("EPSG:4326"),bMap.map.getProjectionObject());switch(x){case 1:d=bMap.markers;b=new OpenLayers.Size(bVars.omSize.w,bVars.omSize.h);y="";v=bVars.mIdArr;w=true;break;case 2:d=bMap.chsMarker;b=new OpenLayers.Size(bVars.chmSize.w,bVars.chmSize.h);y="a";v=bVars.mIdArr;w=false;break;case 3:d=bMap.catChsMarkers;b=new OpenLayers.Size(bVars.catChmSize.w,bVars.catChmSize.h);y="a";v=bVars.chsmIdArr;if(isNaN(m.cc)||typeof m.cc=="undefined"||m.cc==null){w=false}else{w=m.cc}break}if(isNaN(m.icat)||m.icat==0||m.icat==null){g=16}else{g=m.icat}if(typeof m.store=="undefined"){j=bVars.store}else{j=parseFloat(m.store)}var q=null;if(x===3){q=addrUrl.base+"graphics/cmi/top-10.png"}else{q=addrUrl.base+"graphics/cmi/mod/"+g+y+".png"}var h=new OpenLayers.Icon(q,b,new OpenLayers.Pixel(-(b.w/2),-b.h));var p=new OpenLayers.Marker(k,h);p.events.register("mousedown",d,function(a){uBody.openMinisite(j,w);uServe.respiteSCS();OpenLayers.Event.stop(a)});p.planeID=j;d.addMarker(p);bVars.mArr.push(p);v.push(j)};uServe.resetGsNum=function(){bVars.slBtnStepCount=0};uServe.markerAboveBckgr=function(){var a=parseFloat(bMap.bckgrIcons.getZIndex());if(typeof bMap.markers!="undefined"&&a>parseFloat(bMap.markers.getZIndex())){bMap.markers.setZIndex(a+8)}if(typeof bMap.ppm!="undefined"&&a>parseFloat(bMap.ppm.getZIndex())){bMap.ppm.setZIndex(a+9)}if(typeof bMap.chsMarker!="undefined"&&a>parseFloat(bMap.chsMarker.getZIndex())){bMap.chsMarker.setZIndex(a+10)}if(typeof bMap.catChsMarkers!="undefined"&&a>parseFloat(bMap.catChsMarkers.getZIndex())){bMap.catChsMarkers.setZIndex(a+11)}};uServe.toggleBckgr=function(){if(bMap.map.getZoom()>=bVars.bgThreshold){bVars.bgPointer=1}else{bVars.bgPointer=0}if(bVars.bgPointer!=bVars.bgTail){if(bVars.bgPointer>bVars.bgTail){addrUrl.urlBckgr=addrUrl.base+"config/1003/mod/binormal.txt"}else{addrUrl.urlBckgr=addrUrl.base+"config/1003/mod/bismall.txt"}bMap.map.removeLayer(bMap.bckgrIcons);delete bMap.bckgrIcons;bMap.setBckgrIcons();uServe.markerAboveBckgr()}bVars.bgTail=bVars.bgPointer};uServe.loadSlider=function(b){var a=true;$("div.close-wall").off("mousedown").mousedown(function(){uBody.closeWall(true)});clearTimeout(bVars.tLoadSlider);bVars.tLoadSlider=setTimeout(function(){if(!($("div.ls-cont").length>0)){$("td.mw").append("<div class='ls-cont' style='display:none;'></div>")}else{$("div.ls-cont").hide()}$("div.ls-cont").load(addrUrl.loadBlock("slider"),function(){$.getJSON(addrUrl.vapi+"slides_num,gs_num",function(c){if(!($("div.list-cont").length>0)){$("div.ls-cont").remove();return false}else{if($("div.list-cont").is(":hidden")){a=false}}bVars.slideLimit=c.slides_num;bVars.gsLimit=c.gs_num;bVars.countSlide=0;bVars.prevCountSlide=0;uBody.storesListThumb(0,true);switch(bVars.slType){case 1:$("div.ls-cont").attr("id","lsbtn-scats");break;case 2:$("div.back2scat").mousedown(function(){if(bVars.showTTS){uBody.showTTstores()}else{uBody.scatsWall(bVars.cat)}});$("div.ls-cont").attr("id","lsbtn-stores");break;case 3:$("div.ls-cont").attr("id","lsbtn-sch");break;case 5:$("div.ls-cont").attr("id","lsbtn-si");break}if(a){$("div.ls-cont").fadeIn(200)}if(!($("div.close-wall").length>0)&&$("div.rst-list-cont").length>0){$("div.list-cont").append("<div class='subcat-container subcat-container-"+bMap.varsArr.wdir+"'></div>");$.get(addrUrl.loadBlock("wallheader"),function(d){$("div.subcat-container").append(d);$("div.close-wall").mousedown(function(){uBody.closeWall(true)})})}uBody.dragHandler();uBody.slBtnDragHandler()})})},500)};uServe.chmEx=function(){if(typeof bMap.catChsMarkers!="undefined"&&bVars.chsmIdArr.length>0){return true}else{return false}};uServe.markSchList=function(){if(!($("div#schlist").length>0)){return false}if($("div#schlist").is(":visible")){$("div#schlist").append("<input type='hidden' class='shw-sch-list' />")}};uServe.showHiddenMarker=function(b){var a=false;for(var c in bVars.mArr){if(bVars.mArr[c].planeID==bVars.store&&bVars.mArr[c].onScreen()){a=true}}if(a){bMap.map.zoomToMaxExtent()}else{bMap.map.moveTo(new OpenLayers.LonLat(b.x,b.y),bVars.rootScale)}};uServe.controlSclBtns=function(){var a=bMap.map.getZoom();if(a>0){$("div.olControlZoomOutItemInactive").removeClass("scl-btn-act").addClass("scl-btn-pass")}else{$("div.olControlZoomOutItemInactive").removeClass("scl-btn-pass").addClass("scl-btn-act")}if(a<bVars.zoomSup-1){$("div.olControlZoomInItemInactive").removeClass("scl-btn-act").addClass("scl-btn-pass")}else{$("div.olControlZoomInItemInactive").removeClass("scl-btn-pass").addClass("scl-btn-act")}};uServe.rotateAL=function(){$("div.pb-icon>div:eq(0)").rotate({angle:0,animateTo:360,callback:uServe.rotateAL,easing:function(d,b,f,c,a){return c*(b/a)+f}})};uServe.setBrwsPref=function(){if($.browser.mozilla){bVars.brwsPref="-moz-"}else{if($.browser.webkit){bVars.brwsPref="-webkit-"}}};uServe.detectCaret=function(){var a=document.getElementById("sch-area");if(a.selectionStart||a.selectionStart=="0"){bVars.shcPnt=a.selectionStart}};uServe.moveCaret2End=function(){var a=document.getElementById("sch-area");a.selectionStart=a.selectionEnd=bVars.shcPnt=a.value.length};uServe.runCaretLeft=function(){if(bVars.shcPnt==0){return false}var a=document.getElementById("sch-area");a.selectionStart=a.selectionEnd=--bVars.shcPnt};uServe.runCaretRight=function(){var a=document.getElementById("sch-area");if(bVars.shcPnt==a.value.length){return false}a.selectionStart=a.selectionEnd=++bVars.shcPnt};uServe.toggleLsContBckgr=function(b,a){if(b){$("div.list-cont").css("background-image",addrUrl.getImage("ajax-loader_mod","gif"));if(!a){$("div.ls-cont").remove()}}else{$("div.list-cont").css("background-image","none")}};uServe.respiteSCS=function(a){clearTimeout(bVars.makeAtClickFalse);bVars.atClick=true;bVars.makeAtClickFalse=setTimeout(function(){bVars.atClick=false},120000);uBody.closeScrsAnime(a)};uServe.screenSaver=function(){setInterval(function(){if(!bVars.atClick){if(bMap.varsArr.lang!=bMap.varsArr.dlang){uServe.changeLang(bMap.varsArr.dlang)}else{if(uServe.chmEx()&&bVars.pmType!=3||bMap.map.getZoom()>0||$("textarea.sch-field").val().length>0||$("div.minisite-cont").length>0||$("div.list-cont").length>0||$("div#smap").attr("style")>0||typeof bMap.ppm!="undefined"||$("div.olPopup").length>0||$("div.msg-box").is(":visible")||$("div.ui-keyboard").is(":visible")){uBody.back2root()}else{if(!uServe.chmEx()){uBody.toggleMapBtn(true);uBody.showStandByStores()}}$.get(addrUrl.api+21,function(a){if(parseInt(a)>0){uBody.runScrsAnime()}})}}},10000)};uServe.animeClick=function(){uBody.closeScrsAnime();uBody.openMinisite(bVars.scrsStore,true)};uServe.showScrsAnime=function(c,a){if(typeof c=="undefined"||typeof a=="undefined"){return false}var d=(window.innerWidth-a.width)/2;var b=(window.innerHeight-a.height)/2;$.get(addrUrl.svapi("scrslast",c),function(){bVars.scrsStore=c;$(".scrs-anime-layer>div").off("mousedown",uServe.animeClick).hide();$("div.scrs-comm").off("mousedown",uServe.animeClick).hide();if($("div.video-player-scrs").length>0){$("div.video-player-scrs").remove()}if(a.type=="anime"){$("div.sa"+c).css({top:b+"px",left:d+"px",width:a.width+"px",height:a.height+"px"}).show().on("mousedown",uServe.animeClick);$("div.sa"+c+">div").removeAttr("style").show()}else{if(a.type=="comm"){$("div.scrs-comm").css({top:b+"px",left:d+"px",width:a.width+"px",height:a.height+"px"}).show().on("mousedown",uServe.animeClick);uBody.openScrsVideo(c,a)}}})};uServe.scrsAnime=function(){var c=1;var a=[];var d=[];var b=false;$.getJSON(addrUrl.api+20,function(e){$.each(e,function(g,f){a.push(parseFloat(g));d.push(f)});setTimeout(function(){uServe.showScrsAnime(a[0],d[0])},500);bVars.runScrs=setInterval(function(){uServe.showScrsAnime(a[c],d[c]);c++;if(c+1>e.length){clearInterval(bVars.runScrs)}},bVars.scrsRunInterval)})};uBody.runScrsAnime=function(){if($("div.scrs-cont").length>0||$("div.minisite-cont").length>0||$("div.list-cont").length>0){return false}var a=2000;uBody.togglePB(true);$("td.mw").append("<div class='scrs-cont'></div>");$("div.scrs-cont").load(addrUrl.loadBlock("screensaver"),function(){$("div.pb-icon-cont").hide();$("div.scrs-cont").on("mousedown",uBody.closeScrsAnime);$("div.scrs-cls-btn").on("mousedown",uBody.closeScrsAnime)});uServe.scrsAnime();$.get(addrUrl.api+21,function(b){bVars.runScrsQueue=setInterval(function(){uServe.scrsAnime()},bVars.scrsRunInterval*parseFloat(b)+a)})};uBody.closeScrsAnime=function(a){if($("div.scrs-cont").length>0){$("div.scrs-cont").remove()}if(!a){$("div.total-pb-bckgr").off("mousedown",uBody.closeScrsAnime);uBody.togglePB()}clearTimeout(bVars.startScrs);clearInterval(bVars.runScrsQueue);clearInterval(bVars.runScrs)};uBody.closePlayer=function(){if($("div.video-player").length==0){return false}$("div.video-player").remove();$("div.video-close").remove();$("div.total-pb-bckgr").off("mousedown",uBody.closePlayer);uBody.togglePB();if(bVars.singleTrailer){uBody.closeVideo()}};uBody.openPlayer=function(d){var b=36;var f,c,a;uBody.togglePB(true);$.getJSON(addrUrl.api+14,function(e){$("div.pb-icon-cont").hide();f=addrUrl.base+"stores/"+e.tc+"/"+e.store+"/videos/mod/";$("body").append("<div class='video-player'><div id='videoplayer7267'></div></div><div class='video-close'></div>");$("div.video-player").on("mousedown",function(){return false});$("div.video-close").on("mousedown",uBody.closePlayer);$("div.total-pb-bckgr").on("mousedown",uBody.closePlayer);c=(window.innerHeight-e.height)/2;a=(window.innerWidth-e.width)/2;$("div.video-player").css({top:c+"px",left:a+"px"});$("div.video-close").css({top:c-b+"px",left:a+e.width-b+"px"});$.getScript(addrUrl.base+"js/swfobject.js",function(){var g={comment:"uniqoom",st:f+"video55-1659.txt",file:f+d+".flv"};var h={wmode:"transparent",allowFullScreen:"true",allowScriptAccess:"always",id:"videoplayer7267"};new swfobject.embedSWF(addrUrl.base+"animation/uplayer/uppod.swf","videoplayer7267",e.width,e.height,"9.0.115.0",false,g,h)})})};uBody.openVideo=function(){uBody.closeTopTen();$("div.video-btn").removeClass("sm-btn-pass").addClass("sm-btn-act").off("mousedown",uBody.openVideo);setTimeout(function(){$("div.video-btn").on("mousedown",uBody.closeVideo)},500);$.get(addrUrl.api+13,function(a){if(parseFloat(a)>1){$("div.showcase").hide();$("div.pct-uplayer").append("<div class='video-layer'></div>");$("div.video-layer").load(addrUrl.loadBlock("vtrailers"),function(){$("div.vtrailer-icon").click(function(){uBody.openPlayer($(this).attr("id"))})})}else{uBody.openPlayer(1);bVars.singleTrailer=true}})};uBody.closeVideo=function(){$("div.video-btn").removeClass("sm-btn-act").addClass("sm-btn-pass").off("mousedown",uBody.closeVideo);setTimeout(function(){$("div.video-btn").on("mousedown",uBody.openVideo)},500);$("div.video-layer").remove();if($("div.showcase").is(":hidden")){$("div.showcase").show()}bVars.singleTrailer=false};uBody.openScrsVideo=function(b,a){var c;$.getJSON(addrUrl.vapi+"tc",function(d){c=addrUrl.base+"stores/"+d.tc+"/"+b+"/videos/mod/";$("div.scrs-comm").append("<div class='video-player-scrs'><div id='videoplayer7267'></div></div>");$.getScript(addrUrl.getJS("swfobject"),function(){var g={comment:"uniqoom",st:c+"video55-1659.txt",file:c+a.no+".flv"};var f={wmode:"transparent",allowFullScreen:"true",allowScriptAccess:"always",id:"videoplayer7267"};new swfobject.embedSWF(addrUrl.base+"animation/uplayer/uppod.swf","videoplayer7267",a.width,a.height,"9.0.115.0",false,g,f)})})};uBody.showDDList=function(a){$.get(addrUrl.svapi("listtype",a),function(){uBody.togglePB(true);$("div.pb-icon-cont").hide();if($("div.ddl-cont").length>0){$("div.ddl-cont").show();return false}$("td.mw").append("<div class='ddl-cont'></div>");$("div.ddl-cont").load(addrUrl.loadBlock("ddlist"),function(){var b=(window.innerHeight-$("div.ddl-layer").height())/2;$("div.ddl-layer").css({left:(window.innerWidth-$("div.ddl-layer").width())/2+"px",top:b+"px"});$("div.ddl-layer-frame>ul>li").mousedown(function(){webWallSelectCatalogue(parseFloat($(this).attr("id")));$("div.ddl-layer-frame>ul>li>div").removeClass("ddl-act");$(this).children("div").addClass("ddl-act");$("div.ttbh-frame>div").text($(this).children("div").attr("id"));uBody.closeDDList(true)});$("div.ddl-cls-btn").css("top",b).on("mousedown",uBody.closeDDList);$("div.total-pb-bckgr").on("mousedown",uBody.closeDDList)})})};uBody.closeDDList=function(a){if(!($("div.ddl-cont").length>0)){return false}if(a){$("div.ddl-cont").hide()}else{$("div.ddl-cont").remove();$("div.total-pb-bckgr").off("mousedown",uBody.closeDDList)}uBody.togglePB()};uBody.openTopTen=function(){$.getJSON(addrUrl.getFCatId(),function(a){if(!a){return false}$("div.pct-uplayer").hide();$("div.top10-btn").removeClass("sm-btn-pass").addClass("sm-btn-act").off("mousedown",uBody.openTopTen).on("mousedown",uBody.closeTopTen);$("td.mw").append("<div class='tt-cont'></div>");$("div.tt-cont").load(addrUrl.loadBlock("wall"),function(){webWall("50px","50px","he","uadmin.no-ip.biz:8080",parseFloat(a));if($("div.ttcat-btn-header").attr("id")=="ttbh-bckgr-pass"){$("div.ttcat-btn-header").mousedown(function(){uBody.showDDList("ttcat")})}})})};uBody.closeTopTen=function(){if(!($("div.tt-cont").length>0)){return false}$("div.top10-btn").removeClass("sm-btn-act").addClass("sm-btn-pass").off("mousedown",uBody.closeTopTen).on("mousedown",uBody.openTopTen);$("div.tt-cont").remove();$("div.pct-uplayer").show();uBody.closeDDList()};uBody.closeMinisite=function(c,a,d){if($("div.minisite-cont").length<1){return false}if(c){if(uServe.chmEx()){var b;if($.browser.webkit){b=" "}if(bVars.pmType==1&&$("div.rst-list-cont").length>0&&$("div.rst-list-cont").attr("style")!="display: none;"+b||bVars.pmType==2&&$("input.shw-sch-list").length>0){$("div.list-cont").show();$("div.ls-cont").show();uBody.toggleSlTr(true);a=true}else{uServe.toggleListBtn(true)}if(bVars.pmType==2){uBody.makeCbtnPass()}}else{if(!d){uBody.toggleCbtn();uBody.makeCbtnPass();bMap.clearStore();uBody.toggleMapBtn();uBody.closeWall(true)}}uBody.closeTopTen();$("div.minisite-cont").remove()}else{$("div.minisite-cont").hide()}if(!a){uServe.toggleMap(true)}$("div.bann-cell").removeClass("bann-act").addClass("bann-pass")};uBody.loadMinisite=function(b,a){if(!($("div.minisite-cont").length>0)){$("td.mw").append("<div class='minisite-cont'></div>")}uBody.toggleMapBtn(true);$("div.minisite-cont").load(addrUrl.loadBlock("minisite"),function(){if($("div.info-content").height()>135){$("div.info-content").css({"overflow-y":"scroll","overflow-x":"hidden","max-width":"720px","padding-right":"15px"})}else{$("div.info-content").css({overflow:"hidden","max-width":"723px",padding:"0px"})}$("div.cls-btn-cross").mousedown(function(){if(b==0){uBody.back2root();return false}if(bVars.pmType==2){uBody.toggleCbtn()}uBody.closeMinisite(true)});$("div.storemap-btn").mousedown(function(){if(b==0){uBody.back2root()}else{bMap.storeOnMap()}});if($("div.top10-btn").length>0){$("div.top10-btn").on("mousedown",uBody.openTopTen)}if($("div.video-btn").length>0){$("div.video-btn").on("mousedown",uBody.openVideo)}})};uBody.openMinisite=function(b,a){if(bVars.dragCrit){return false}uServe.toggleMap();if(a){uBody.toggleCbtn()}uServe.markSchList();uBody.closeWall();uServe.toggleListBtn(false);bMap.clearPopupMarkers();uBody.leaveFullcsreen();bMap.clearBckgrIcons();uBody.closeTopTen();uBody.closeSi();bMap.clearStore();if($("div.minisite-cont").length>0){if(bVars.store==b){$("div.minisite-cont").show();uBody.toggleMapBtn(true);return false}else{$("div.minisite-cont").remove()}}bVars.store=parseFloat(b);$.get(addrUrl.svapi("store",bVars.store),function(){if(bVars.store==0){uBody.loadMinisite(bVars.store);uBody.toggleCbtn();uBody.makeCbtnPass();return false}if(a){$.get(addrUrl.getStoreCat(bVars.store),function(c){uBody.makeCbtnPass();if(isNaN(c)){bVars.cat=16;uBody.makeCbtnAct()}else{bVars.cat=parseFloat(c);if(uServe.inArray(bVars.cat,bVars.specCat)){uBody.makeCbtnAct()}else{uBody.toggleCbtn(true)}}bVars.divcbtnNo=bVars.cat;uBody.loadMinisite(bVars.store);if(bVars.pmType!==2){bMap.clearChsMarkers()}})}else{uBody.loadMinisite(bVars.store)}if(uServe.chmEx()){bVars.openOrigin=1}else{bVars.openOrigin=2}})};bMap.setMarkers=function(){var b;var a=[];var c=[];$.getJSON(addrUrl.markers(),function(d){a.length=0;$.each(d,function(f,e){$.each(e,function(h,g){b=parseFloat(h);if(uServe.chmEx()&&uServe.inArray(b,bVars.chsmIdArr)||bVars.somCrit&&b==bVars.store||typeof bMap.ppm!="undefined"&&g[2]==bMap.varsArr.bankers){return true}if(!uServe.inArray(b,bVars.mIdArr)){uServe.addNewMarker({x:g[0],y:g[1],icat:g[2],store:b},1)}a.push(b)})});c=uServe.arrSub(bVars.mIdArr,a);if(c.length>0){$.each(c,function(g,f){if(f==bVars.store){return true}for(var h in bVars.mArr){if(bVars.mArr[h].planeID==f){bMap.markers.removeMarker(bVars.mArr[h]);bVars.mArr.splice(h,1)}}})}bVars.mIdArr=a})};bMap.clearBckgrIcons=function(){if(!($("div.olPopup").length>0)){return false}$("div.olPopup").remove()};bMap.setBckgrIcons=function(){if(typeof bMap.bckgrIcons!="undefined"){return false}bMap.bckgrIcons=new OpenLayers.Layer.Vector("POIs",{strategies:[new OpenLayers.Strategy.BBOX({resFactor:1.1})],protocol:new OpenLayers.Protocol.HTTP({url:addrUrl.urlBckgr,format:new OpenLayers.Format.Text})});bMap.map.addLayer(bMap.bckgrIcons);bMap.selectControl=new OpenLayers.Control.SelectFeature(bMap.bckgrIcons);bMap.map.addControl(bMap.selectControl);bMap.selectControl.activate();bMap.bckgrIcons.events.on({featureselected:uBody.onFeatureSelect,featureunselected:uBody.onFeatureUnselect})};bMap.showPopup=function(j,m){var d=400;var b=200;var g=new OpenLayers.Popup("mod-popup",new OpenLayers.LonLat(j,m),new OpenLayers.Size(d,b),"<canvas id='myCanvas' width='"+d+"' height='"+b+"'></canvas>",true);g.setBackgroundColor("transparent");bMap.map.addPopup(g);$("div.olPopupCloseBox").css({top:"17px",right:"34px",width:"64px",height:"64px","background-image":addrUrl.getImage("cls_popup_inv")});var p=document.getElementById("myCanvas");var c=p.getContext("2d");var l=34;var k=85;var h=205;$.get(addrUrl.getLbl(134),function(a){c.beginPath();c.moveTo(3,3);c.lineWidth=5;c.lineTo(100,45);c.lineTo(360,45);c.lineTo(360,180);c.lineTo(50,180);c.lineTo(50,100);c.lineTo(3,2);c.fillStyle="#4b6370";c.fill();c.font="18pt Verdana";c.textAlign="center";c.fillStyle="#c9e12d";$.each(a.split("/"),function(i,f){c.fillText(f,h,k+l*i)});c.strokeStyle="#c9e12d";c.stroke()})};bMap.clearPopupMarkers=function(){if(typeof bMap.ppm=="undefined"){return false}bMap.map.removeLayer(bMap.ppm);delete bMap.ppm;if(bMap.map.getZoom()>=bVars.maxScale){$.each(bMap.ppCoords,function(b,a){uServe.addNewMarker({x:a.x,y:a.y,icat:a.icat,store:a.id},1)})}bMap.ppCoords.length=0};bMap.setPopupMarkers=function(d){if(typeof bMap.ppm!="undefined"){return false}var b,f,c;var a="df";uBody.closeWall(true,true);uBody.closeMinisite();uBody.closeTopTen();uServe.toggleMap(true);uBody.toggleMapBtn(true);bMap.clearStore();bMap.clearBckgrIcons();bMap.clearChsMarkers();bVars.cat=d;uBody.toggleCbtn();uBody.makeCbtnAct();bMap.map.zoomToMaxExtent();bMap.ppm=new OpenLayers.Layer.Markers("ppm");bMap.map.addLayer(bMap.ppm);bMap.ppm.setZIndex(752);$.getJSON(addrUrl.api+3,function(g){$.each(g,function(i,h){b=(new OpenLayers.LonLat(h.x,h.y)).transform(new OpenLayers.Projection("EPSG:4326"),bMap.map.getProjectionObject());f=new OpenLayers.Size(120,97);c=new OpenLayers.Icon(addrUrl.base+"graphics/cmi/banker.png",f,new OpenLayers.Pixel(-(f.w/2),-f.h));bMap.ppCoords.push({id:h.id,x:h.x,y:h.y,icat:bMap.varsArr.bankers});var j=new OpenLayers.Marker(b,c);j.events.register("mousedown",bMap.ppm,function(k){uBody.openMinisite(h.id,true);OpenLayers.Event.stop(k)});bMap.ppm.addMarker(j);$.each(jQuery.parseJSON(h["descr_"+a]),function(e,k){$(bMap.ppm.markers[i]["events"]["element"]).append("<span class='cit "+e+"'>"+k+"</span><br/>")})})})};bMap.setMap=function(c){var b=new OpenLayers.Bounds(36.28608,49.9957,36.31434,50.01656);var a={projection:"EPSG:4326",controls:[new OpenLayers.Control.Navigation({dragPanOptions:{enableKinetic:true}})],restrictedExtent:b,maxExtent:b,numZoomLevels:7,maxResolution:"auto"};bMap.map=new OpenLayers.Map(c,a);bMap.map.addLayer(new OpenLayers.Layer.WMS("Barabashovo","http://uadmin.no-ip.biz:8080/geoserver/uniqoom/wms?BGCOLOR=0x000000",{layers:"2013-07-14-kiosk",format:"image/png"}));uBody.setOverview();uBody.setSclCnt();uBody.setPanCnt();bMap.setBckgrIcons();bMap.map.events.register("move",null,bMap.controlScale);bMap.map.zoomToMaxExtent()};bMap.dragControlOn=function(){bMap.dcSwitch=new OpenLayers.Control.DragPan({map:bMap.map,panMapDone:function(a){bMap.map.userdragged=true;console.log("drag");bMap.setMarkers()}});bMap.dcSwitch.draw();bMap.map.addControl(bMap.dcSwitch);bMap.dcSwitch.activate()};bMap.dragControlOff=function(){bMap.map.removeControl(bMap.dcSwitch);bMap.dcSwitch.deactivate()};bMap.controlScale=function(){if(bMap.map.getZoom()>=bVars.maxScale){if(typeof bMap.markers=="undefined"){bMap.markers=new OpenLayers.Layer.Markers("Markers");bMap.map.addLayer(bMap.markers);uServe.markerAboveBckgr();bMap.dragControlOn()}clearTimeout(bVars.tMapMove);bVars.tMapMove=setTimeout(function(){bMap.setMarkers()},500);uBody.togglePanCnt(true)}else{if(typeof bMap.markers!="undefined"){bVars.mIdArr.length=0;bMap.map.removeLayer(bMap.markers);delete bMap.markers;bMap.dragControlOff()}uBody.togglePanCnt()}uBody.toggleMapBtn(true);uServe.toggleBckgr();uServe.controlSclBtns();uServe.respiteSCS()};bMap.storeOnMap=function(){uBody.closeMinisite();uBody.closeTopTen();bMap.clearStore();bMap.clearChsMarkers();uBody.toggleAddCbtn(true);if(bVars.cat==bMap.varsArr.bankers){bMap.clearPopupMarkers()}var b=null;var c={};var a=[];a.push($.getJSON(addrUrl.api+9,function(d){if(d[0]["x"]===null){return false}bVars.somCrit=true;bMap.chsMarker=new OpenLayers.Layer.Markers("chsMarker");bMap.map.addLayer(bMap.chsMarker);bMap.stCoords.push({x:d[0]["x"],y:d[0]["y"],icat:bVars.cat});uServe.addNewMarker(bMap.stCoords[0],2);uServe.showHiddenMarker({x:bMap.stCoords[0]["x"],y:bMap.stCoords[0]["y"]});uServe.markerAboveBckgr();b="http://uadmin.no-ip.biz:8080/geo?SERVICE=UniqoomAPI&REQUEST=path&X1="+36.310059173938+"&Y1="+50.006908617281+"&X2="+d[0]["x"]+"&Y2="+d[0]["y"]+"&jsoncallback=?"}));$.when.apply($,a).then(function(){$.getJSON(b,function(h){if(bMap.path!==null){bMap.map.removeLayer(bMap.path);bMap.path=null}bMap.path=new OpenLayers.Layer.Vector("Path");bMap.map.addLayer(bMap.path);var g=[];h.forEach(function(i){g.push(new OpenLayers.Geometry.Point(i[0],i[1]).transform(new OpenLayers.Projection("EPSG:4326"),bMap.map.getProjectionObject()))});var d=new OpenLayers.Geometry.LineString(g);var f={strokeColor:"#ff5f17",strokeOpacity:0.75,strokeWidth:5};var e=new OpenLayers.Feature.Vector(d,null,f);bMap.path.addFeatures([e])})})};bMap.clearStore=function(){if(!bVars.somCrit||typeof bMap.chsMarker=="undefined"){return false}bVars.somCrit=false;if(bMap.map.getZoom()>=bVars.maxScale){$.each(bMap.stCoords,function(b,a){uServe.addNewMarker({x:a.x,y:a.y,icat:a.icat,store:bVars.store},1)})}bVars.store=null;bMap.stCoords.length=0;bMap.map.removeLayer(bMap.chsMarker);delete bMap.chsMarker};bMap.clearChsMarkers=function(){if(!uServe.chmEx()){return false}if(bMap.map.getZoom()>=bVars.maxScale){$.each(bMap.chmCoords,function(b,a){uServe.addNewMarker({x:a.x,y:a.y,icat:a.icat,store:a.store},1)})}uServe.toggleListBtn(false);bVars.chsmIdArr.length=0;bMap.chmCoords.length=0;bMap.map.removeLayer(bMap.catChsMarkers);delete bMap.catChsMarkers};bMap.scaleByHint=function(){bMap.map.zoomTo(bVars.maxScale)};bMap.centerMBM=function(){$.getJSON(addrUrl.getMCoords(),function(a){uBody.closeWall(true);uBody.closeMinisite(true);bMap.clearStore();bMap.clearChsMarkers();bMap.clearPopupMarkers();uBody.toggleCbtn();uBody.makeCbtnPass();uServe.toggleMap(true);bMap.clearBckgrIcons();bMap.map.moveTo(new OpenLayers.LonLat(a.lon,a.lat),5);bMap.showPopup(a.lon,a.lat)})};uBody.toggleCbtn=function(b){var a=$("div.ci-cont-bckgr").length>0&&$("div.cn-cont-bckgr").length>0;if(b&&!a){var c;if($.browser.webkit){mspTF=1;mspBF=0;mspTB=1;mspBB=0}else{if($.browser.mozilla){mspTF=1;mspBF=0;mspTB=1;mspBB=0}}if($("div.rst-list-cont").length>0){$("div.list-cont").remove()}$("div.cbtn"+bVars.cat).removeClass("cbtn-act cbtn-pass").css({"margin-top":mspTF+"px","margin-bottom":mspBF+"px"}).off("mousedown");$("div.ci-cont"+bVars.cat).wrap("<div class='ci-cont-bckgr'></div>").css("background-image",addrUrl.getIcon(bVars.cat)).on("mousedown",uBody.scatsWall);$(".cn-cont"+bVars.cat+" span.cname").hide();$("div.cn-cont"+bVars.cat).wrap("<div class='cn-cont-bckgr'></div>").append("<span id='scname'></span>");$.get(addrUrl.getScatName(),function(d){$("span#scname").text(d)});$.get(addrUrl.getLbl(122),function(d){$("div.cn-cont-bckgr").on("mousedown",uBody.showTTstores)});uBody.makeSiBtnPass()}else{if(!b&&a){$("div.ci-cont"+bVars.divcbtnNo).unwrap().off("mousedown",uBody.scatsWall);$("div.cn-cont"+bVars.divcbtnNo).unwrap().off("mousedown",uBody.storesWall);$("div.cbtn"+bVars.divcbtnNo).css({"margin-top":mspTB+"px","margin-bottom":mspBB+"px"}).mousedown(function(){uBody.scatsWall(parseFloat($(this).attr("id")))});$("span#scname").remove();$(".cn-cont"+bVars.divcbtnNo+" span").show()}}};uBody.makeCbtnAct=function(){if(bVars.cat==null){return false}$("div.cbtn"+bVars.cat).removeClass("cbtn-act2 cbtn-pass").addClass("cbtn-act");$("div.ci-cont"+bVars.cat).css("background-image",addrUrl.getIcon(bVars.cat+"act"));if(typeof bVars.divcbtnNo!=null&&bVars.divcbtnNo!=bVars.cat){uBody.makeCbtnPass()}bVars.divcbtnNo=bVars.cat;uBody.makeSiBtnPass()};uBody.makeCbtnPass=function(){if($("div.cbtn"+bVars.divcbtnNo).hasClass("cbtn-pass")||$("div.ci-cont-bckgr").length>0&&$("div.cn-cont-bckgr").length>0){return false}$("div.cbtn"+bVars.divcbtnNo).removeClass("cbtn-act").addClass("cbtn-pass");$("div.ci-cont"+bVars.divcbtnNo).css("background-image",addrUrl.getIcon(bVars.divcbtnNo))};uBody.makeSiBtnAct=function(){uBody.makeCbtnPass();$("div.sibtn").removeClass("sibtn-pass").addClass("sibtn-act");$("div.sibtn-icon").css("background-image",addrUrl.getIcon("siact"))};uBody.makeSiBtnPass=function(){$("div.sibtn").removeClass("sibtn-act").addClass("sibtn-pass");$("div.sibtn-icon").css("background-image",addrUrl.getIcon("si"));$.get(addrUrl.getLbl(10),function(a){$("div.sibtn-name").text(a)})};uBody.toggleMapBtn=function(a){clearTimeout(bVars.tbToRoot);bVars.tbToRoot=setTimeout(function(){var b=bVars.somCrit||typeof bMap.ppm!="undefined"||$("div.olPopup").length>0||uServe.chmEx()&&bVars.pmType!=3||$("div.list-cont").length>0||$("div.minisite-cont").length>0||bMap.map.getZoom()>bVars.rootScale;var c=$("textarea.sch-field").val().length>0;if(a&&(b||c)){$.get(addrUrl.getLbl(112),function(d){$(".map-btn").text(d).removeClass("mbtn-act").addClass("map-pass").on("mousedown",uBody.back2root)})}else{if(!b){$.get(addrUrl.getLbl(108),function(d){$(".map-btn").text(d).removeClass("map-pass").addClass("mbtn-act").off("mousedown",uBody.back2root);if($("textarea.sch-field").val().length>0){$("textarea.sch-field").val("")}})}}},300)};uBody.closeWall=function(b,a){if($("div.list-cont").length<1){return false}if(b){uServe.toggleMap(true);if($("div.list-cont").is(":visible")){if(bVars.pmType==1&&$("div.rst-list-cont").length>0){uServe.toggleListBtn(true);$("div.list-cont").hide();$("div.rst-list-cont").hide();$("div.ls-cont").hide();return false}else{if(bVars.pmType==2){bMap.clearChsMarkers()}}}$.get(addrUrl.svapi("scat",null));$("div.list-cont").remove();$("div.ls-cont").remove();uBody.makeCbtnPass();bVars.cat=null;if(!a){uBody.toggleMapBtn()}}else{$("div#scats").hide();$("div.list-cont").hide();$("div.ls-cont").hide()}uBody.toggleSlTr()};uBody.showTTstores=function(){uBody.closeMinisite(true,true,true);uBody.toggleAddCbtn();if(uServe.chmEx()&&bVars.pmType==1){if($("div.list-cont:visible").length>0){uBody.closeWall(true)}uServe.toggleMap(true)}else{if(bVars.pmType==2){$("div.list-cont").remove();$("div.ls-cont").remove();uBody.toggleSlTr();uBody.togglePB(true)}bVars.pmType=1;$.getJSON(addrUrl.getPrmSt(),function(a){if(a){uBody.showSpm(a,true)}else{return false}})}};uBody.storesListThumb=function(b,a){if(!a&&(bVars.dragSlBtnCrit||b==bVars.countSlide)){return false}bVars.countSlide=b;bVars.ssCorrVal=bVars.countSlide*bVars.ssCorr;if(!a){uBody.moveSlides(true)}};uBody.protectLimits=function(a){switch(a){case 0:clearTimeout(bVars.allowSlBtnProtect);if(bVars.slBtnStepCount-1<0||bVars.slBtnStepCount+1==bVars.gsLimit){bVars.allowSlBtnProtect=setTimeout(function(){$("div.ls-btn-cont").mouseup()},100)}break;case 1:clearTimeout(bVars.allowProtect);if(bVars.countSlide+1==bVars.slideLimit||bVars.countSlide==0){bVars.allowProtect=setTimeout(function(){$("div.slides-cont").mouseup()},250)}break}};uBody.slidePrev=function(){if(bVars.countSlide-1>=0){bVars.countSlide--;bVars.ssCorrVal-=bVars.ssCorr}};uBody.slideNext=function(){if(bVars.countSlide+1<bVars.slideLimit){bVars.countSlide++;bVars.ssCorrVal+=bVars.ssCorr}};uBody.moveSlides=function(b){if(!b){if(bVars.slideBegPos<bVars.slideEndPos){if(bMap.varsArr.wdir=="rtl"){uBody.slideNext()}else{if(bMap.varsArr.wdir=="ltr"){uBody.slidePrev()}}}else{if(bMap.varsArr.wdir=="rtl"){uBody.slidePrev()}else{if(bMap.varsArr.wdir=="ltr"){uBody.slideNext()}}}}$("div.slides-cont").animate({left:(bVars.slideStep*bVars.countSlide-bVars.ssCorrVal)*-1+"px"},"fast");if(bVars.countSlide!=bVars.prevCountSlide){$("div.ls-btn").eq(bVars.countSlide).removeClass("ls-btn-pass").addClass("ls-btn-act");$("div.ls-btn").eq(bVars.prevCountSlide).removeClass("ls-btn-act").addClass("ls-btn-pass")}if(!b&&bVars.gsLimit>1){var a=9;if(bVars.countSlide==a*(bVars.slBtnStepCount+1)+(bVars.slBtnStepCount+1)&&bVars.countSlide>bVars.prevCountSlide){if(bMap.varsArr.wdir=="rtl"){uBody.moveLsBtn(1)}else{if(bMap.varsArr.wdir=="ltr"){uBody.moveLsBtn(0)}}}if(bVars.countSlide==a*bVars.slBtnStepCount+(bVars.slBtnStepCount-1)&&bVars.countSlide<bVars.prevCountSlide){if(bMap.varsArr.wdir=="rtl"){uBody.moveLsBtn(0)}else{if(bMap.varsArr.wdir=="ltr"){uBody.moveLsBtn(1)}}}}bVars.prevCountSlide=bVars.countSlide};uBody.dragHandler=function(){if($("div.list-slider").length>0){$("div.ls-btn").click(function(){uBody.storesListThumb($("div.ls-btn").index(this))})}$("div.slides-cont").draggable({axis:"x",iframeFix:true,distance:50,start:function(b,a){clearTimeout(bVars.allowClick);bVars.dragCrit=true;bVars.slideBegPos=a.position.left;uBody.protectLimits(1)},stop:function(b,a){bVars.allowClick=setTimeout(function(){bVars.dragCrit=false},750);bVars.slideEndPos=a.position.left;uBody.moveSlides()}})};uBody.storesWall=function(){if($("div.minisite-cont:visible").length>0){uBody.closeMinisite(true,true)}bVars.slType=2;uServe.toggleListBtn(false);uServe.toggleMap();uBody.slTriangle();uBody.toggleSlTr(true);if($("div.rst-list-cont").length>0){$("div.list-cont").show();$("div.rst-list-cont").show();$("div.ls-cont").show();return false}uServe.resetGsNum();if(!($("div.list-cont").length>0)){$("td.mw").append("<div class='list-cont'></div>")}$("div.list-cont:hidden").show();$("div.list-cont").append("<div class='rst-list-cont'></div>");$.get(addrUrl.svapi("slider",bVars.slType),function(){$("div.rst-list-cont").load(addrUrl.loadBlock("stlist"),function(){uServe.toggleLsContBckgr();$("div.rst-el").click(function(){uBody.openMinisite($(this).attr("id"))});uServe.loadSlider()})})};uBody.toggleSlTr=function(a){if(a&&$("div.sl-tr").is(":hidden")){$("div.sl-tr").show()}else{if(!a&&$("div.sl-tr").is(":visible")){$("div.sl-tr").hide()}}};uBody.slTriangle=function(d){var b,f;if(d){b=8}else{b=bVars.divcbtnNo-9}if($.browser.mozilla){f=324}else{if($.browser.webkit){f=323}}var c=73;var a=f+c*b;$("div.sl-tr").show().css("top",a)};uBody.scatsWall=function(b){if(bVars.dragCrit){return false}var a;bVars.slType=1;if(!uBody.closeMinisite(true)){bVars.store=null}if(isNaN(b)){a=false}else{a=bVars.cat!=b;bVars.cat=b}uBody.toggleCbtn();if($("div.cbtn"+bVars.cat).hasClass("cbtn-pass")){if($("div.subcat-container").length>0){$("div.subcat-container").remove()}else{if($("div.stores-container").length>0){$("div.stores-container").remove()}else{if($("div.sch-container").length>0){$("div.sch-container").remove()}}}}uBody.makeCbtnAct();uBody.slTriangle();bMap.clearStore();uBody.closeMinisite(true);bMap.clearChsMarkers();bMap.clearPopupMarkers();bMap.clearBckgrIcons();uServe.toggleMap();bVars.ssCorrVal=0;uServe.toggleListBtn(false);uServe.resetGsNum();uBody.closeSi();if(!($("div.list-cont").length>0)){$("td.mw").append("<div class='list-cont'></div>")}else{if(!($("div.rst-list-cont").length>0)&&!a){$("div.list-cont").show();$("div#scats").show();uServe.toggleLsContBckgr();uServe.loadSlider();return false}else{if($("div.rst-list-cont").length>0){$("div.rst-list-cont").remove()}}}if($("div.list-cont").attr("style")!=null){$("div.list-cont").removeAttr("style")}$.get(addrUrl.svapi("cat,slider",bVars.cat+","+bVars.slType),function(){$("div.list-cont").show().load(addrUrl.loadBlock("ellist"),function(){uServe.toggleLsContBckgr();$("div.store-btn-bckgr").click(function(){bVars.pmType=1;if(!bVars.dragCrit){uBody.togglePB(true)}$.get(addrUrl.svapi("scat",$(this).attr("id")),function(){$.getJSON(addrUrl.getPrmSt(),function(c){if(c){bVars.showTTS=true;uBody.showSpm(c)}else{bVars.showTTS=false;uBody.togglePB();uBody.closeWall();uBody.storesWall();uServe.toggleListBtn(false)}})})});uServe.loadSlider()});uBody.toggleMapBtn(true)})};uBody.schWall=function(){if($("textarea#sch-area").val().length==0){return false}bVars.slType=3;uServe.toggleListBtn(false);uServe.toggleMap();uServe.resetGsNum();uBody.toggleSlTr();if($("div.list-cont").length>0){$("div.list-cont").show()}else{$("td.mw").append("<div class='list-cont'></div>")}$("div.list-cont").css("left","23px");$.get(addrUrl.svapi("slider",bVars.slType),function(){$("div.list-cont").load(addrUrl.loadBlock("schlist"),function(){$("div.list-cont").css("background-image","none");$("div.store-btn-bckgr").click(function(){uBody.openMinisite($(this).attr("id"),true)});uServe.loadSlider()})})};uBody.slBtnDragHandler=function(){if(!($("div.ls-move").length>0)){return false}$("div.ls-btn-cont").draggable({axis:"x",iframeFix:true,distance:50,start:function(b,a){clearTimeout(bVars.allowSlBtnClick);bVars.dragSlBtnCrit=true;bVars.slBtnSlideBegPos=a.position.left;uBody.protectLimits(0)},stop:function(b,a){bVars.allowSlBtnClick=setTimeout(function(){bVars.dragSlBtnCrit=false},500);if(bVars.slBtnSlideBegPos<a.position.left){uBody.moveLsBtn(1)}else{uBody.moveLsBtn(0)}}});$("div.ls-move").mousedown(function(){if($(this).hasClass("ls-move-act")){return false}if(bMap.varsArr.wdir=="rtl"){if($(this).attr("id")=="beg"){uBody.moveLsBtn(0)}else{if($(this).attr("id")=="end"){uBody.moveLsBtn(1)}}}else{if(bMap.varsArr.wdir=="ltr"){if($(this).attr("id")=="beg"){uBody.moveLsBtn(1)}else{if($(this).attr("id")=="end"){uBody.moveLsBtn(0)}}}}})};uBody.moveLsBtn=function(d){if(bVars.moveLsBtnLimiter){return false}var b=685;var f=5;var c=false;var a=false;bVars.moveLsBtnLimiter=true;if(bVars.allowSlBtnProtect!=null&&bVars.slBtnStepCount+1==bVars.gsLimit){a=true}if(bVars.allowSlBtnProtect!=null&&bVars.slBtnStepCount-1<0){c=true}if(d==1){if(bMap.varsArr.wdir=="rtl"){if(a){$("div.ls-btn-cont").animate({left:b*bVars.slBtnStepCount+f*bVars.slBtnStepCount+"px"},"fast")}else{$("div.ls-btn-cont").animate({left:b*++bVars.slBtnStepCount+f*bVars.slBtnStepCount+"px"},"slow")}}else{if(bMap.varsArr.wdir=="ltr"){if(c){$("div.ls-btn-cont").animate({left:"0px"},"fast")}else{$("div.ls-btn-cont").animate({left:b*--bVars.slBtnStepCount*-1-f*bVars.slBtnStepCount+"px"},"slow")}}}}else{if(d==0){if(bMap.varsArr.wdir=="rtl"){if(c){$("div.ls-btn-cont").animate({left:"0px"},"fast")}else{$("div.ls-btn-cont").animate({left:b*--bVars.slBtnStepCount+f*bVars.slBtnStepCount+"px"},"slow")}}else{if(bMap.varsArr.wdir=="ltr"){if(a){$("div.ls-btn-cont").animate({left:b*bVars.slBtnStepCount*-1-f*bVars.slBtnStepCount+"px"},"fast")}else{$("div.ls-btn-cont").animate({left:b*++bVars.slBtnStepCount*-1-f*bVars.slBtnStepCount+"px"},"slow")}}}}}if(bVars.slBtnStepCount==0){$("div.ls-move-beg").removeClass("ls-move-pass").addClass("ls-move-act")}else{$("div.ls-move-beg").removeClass("ls-move-act").addClass("ls-move-pass")}if(bVars.slBtnStepCount+1==bVars.gsLimit){$("div.ls-move-end").removeClass("ls-move-pass").addClass("ls-move-act")}else{$("div.ls-move-end").removeClass("ls-move-act").addClass("ls-move-pass")}setTimeout(function(){bVars.moveLsBtnLimiter=false},500)};uBody.showSpm=function(b,a){if(bVars.pmType==1&&bVars.dragCrit||bVars.pmType==2&&$("textarea#sch-area").val().length==0){return false}if(uServe.chmEx()){bMap.clearChsMarkers()}uServe.toggleMap(true);uBody.closeSi();bMap.catChsMarkers=new OpenLayers.Layer.Markers("catChsMarkers");bMap.map.addLayer(bMap.catChsMarkers);uServe.markerAboveBckgr();switch(bVars.pmType){case 1:uBody.togglePB();bMap.map.zoomToMaxExtent();clearTimeout(bVars.ttglBtn);bVars.ttglBtn=setTimeout(function(){uBody.toggleCbtn(true)},200);uBody.closeWall();if(!a){uServe.toggleLsContBckgr(true)}$.get(addrUrl.getLbl(114),function(c){$("div.show-st-list").off("mousedown",uBody.schWall).on("mousedown",uBody.storesWall).text(c)});$.each(b,function(d,c){var f={x:c[0]["x"],y:c[0]["y"],icat:bVars.cat,store:parseFloat(d)};uServe.addNewMarker(f,3);bMap.chmCoords.push(f)});uServe.toggleListBtn(true);break;case 2:uBody.closeWall(true,true);uBody.toggleCbtn();uBody.makeCbtnPass();uBody.togglePB(true);uBody.closeMinisite(true,true);bMap.clearStore();uBody.closeTopTen();bMap.clearBckgrIcons();bMap.clearPopupMarkers();$.get(addrUrl.svapi("sch_txt",b),function(){$.get(addrUrl.getLbl(117),function(c){$("div.show-st-list").off("mousedown",uBody.storesWall).on("mousedown",uBody.schWall).text(c)});$.getJSON(addrUrl.getSchId(),function(c){if(!c){uBody.openMsgBox(118);return false}$.each(c,function(f,d){var g={x:d.x,y:d.y,icat:d.cat,store:d.id,cc:true};uServe.addNewMarker(g,3);bMap.chmCoords.push(g)});if(c.length==1){uServe.showHiddenMarker({x:c[0]["x"],y:c[0]["y"]})}else{bMap.map.zoomToMaxExtent()}uServe.toggleListBtn(true);uBody.togglePB()})});uServe.markerAboveBckgr();break;case 3:$.each(b,function(d,c){var f={x:c.x,y:c.y,icat:c.cat,store:c.id,cc:true};uServe.addNewMarker(f,3);bMap.chmCoords.push(f)});break}};uBody.back2root=function(){uBody.closeWall(true);uBody.closeMinisite(true);bMap.map.moveTo(new OpenLayers.LonLat(0,0),bVars.rootScale);bMap.clearStore();bMap.clearChsMarkers();bMap.clearPopupMarkers();uBody.toggleCbtn();uBody.makeCbtnPass();uServe.toggleMap(true);bMap.clearBckgrIcons();uBody.leaveFullcsreen();uBody.closeMsgBox();uBody.clsVKbd();uBody.toggleMapBtn();$("div.ui-keyboard").hide();uBody.showStandByStores();uBody.closeSi();uBody.setOverview();if(bMap.path!==null){bMap.map.removeLayer(bMap.path);bMap.path=null}};uBody.bannRenewal=function(){var b=0;var a=1;bVars.brCycle=setInterval(function(){$("div.bann-group-"+b).fadeOut(700);if(b+1>a){b=0}else{b++}$("div.bann-group-"+b).fadeIn(1000)},10000)};uBody.togglePB=function(a){if(a&&$("div.total-pb-bckgr").is(":hidden")){$("div.total-pb-bckgr").show();$("div.pb-icon-cont").show().on("mousedown",function(){return false});uServe.rotateAL()}else{if(!a&&$("div.total-pb-bckgr").is(":visible")){$("div.total-pb-bckgr").hide();$("div.pb-icon-cont").hide().off("mousedown")}}};uBody.closeMsgBox=function(){if($("div.msg-box").is(":hidden")){return false}$("div.msg-box").hide();$("div.total-pb-bckgr").off("mousedown",uBody.closeMsgBox);uBody.togglePB()};uBody.openMsgBox=function(a){$.get(addrUrl.getLbl(a),function(b){uBody.togglePB(true);$("div.pb-icon-cont").hide();$("div.msg-box").show().css({left:(window.innerWidth-$("div.msg-box").width())/2+"px",top:(window.innerHeight-$("div.msg-box").height())/2+"px"}).on("mousedown",function(){return false});$("div.msg-txt>div").text(b);$("div.msg-cls").on("mousedown",uBody.closeMsgBox);$("div.total-pb-bckgr").on("mousedown",uBody.closeMsgBox);$(document).keydown(function(c){if(c.keyCode==27){uBody.closeMsgBox()}})})};uBody.onPopupClose=function(b){var a=this.feature;if(a.layer){bMap.selectControl.unselect(a)}else{this.destroy()}};uBody.onFeatureSelect=function(a){feature=a.feature;popup=new OpenLayers.Popup.FramedCloud("featurePopup",feature.geometry.getBounds().getCenterLonLat(),new OpenLayers.Size(100,100),"<span class='popup-header'>"+feature.attributes.title+"</span><hr/><span class='popup-text'>"+feature.attributes.description+"</span>",null,true,uBody.onPopupClose);feature.popup=popup;popup.feature=feature;bMap.map.addPopup(popup,true);uBody.toggleMapBtn(true);uBody.makeCbtnPass();bMap.clearPopupMarkers();bMap.clearStore();bMap.clearChsMarkers();uBody.toggleCbtn();uBody.makeCbtnPass()};uBody.onFeatureUnselect=function(a){feature=a.feature;if(feature.popup){popup.feature=null;bMap.map.removePopup(feature.popup);feature.popup.destroy();feature.popup=null;setTimeout(function(){if(!($("div.olPopup").length>0)){uBody.toggleMapBtn()}},400)}};uBody.setSclCnt=function(){bMap.sclPnl=new OpenLayers.Control.Panel({div:document.getElementById("scl-cnt")});bMap.map.addControl(bMap.sclPnl);bMap.cntZoomIn=new OpenLayers.Control.ZoomIn;bMap.cntZoomOut=new OpenLayers.Control.ZoomOut;bMap.map.addControl(bMap.cntZoomIn);bMap.map.addControl(bMap.cntZoomOut);bMap.sclPnl.addControls([bMap.cntZoomIn,bMap.cntZoomOut]);$("div.olControlZoomInItemInactive").addClass("scl-btn-pass").append("<span>+</span>").mousedown(function(){bVars.pprsLong=setTimeout(function(){bMap.map.zoomTo(bVars.zoomSup-1)},650)}).mouseup(function(){clearTimeout(bVars.pprsLong)});$("div.olControlZoomOutItemInactive").addClass("scl-btn-act").append("<span>−</span>").mousedown(function(){bVars.nprsLong=setTimeout(function(){bMap.map.zoomTo(0)},650)}).mouseup(function(){clearTimeout(bVars.nprsLong)});$("div#scl-cnt").append("<div id='pan-panel'></div><div class='go-fscr'><div class='go-fscr-icon'></div></div><div class='leave-fscr'><div class='leave-fscr-icon'></div></div>")};uBody.togglePanCnt=function(a){if(a&&$("div#pan-panel").is(":hidden")){$("div#pan-panel").show().animate({height:"352px"},650)}else{if(!a&&$("div#pan-panel").is(":visible")){$("div#pan-panel").animate({height:"0px"},{duration:650,complete:function(){$(this).hide()}})}}};uBody.setPanCnt=function(){bMap.panPnl=new OpenLayers.Control.Panel({div:document.getElementById("pan-panel")});bMap.map.addControl(bMap.panPnl);bMap.panCnt=new OpenLayers.Control.PanPanel({slideFactor:500});bMap.map.addControl(bMap.panCnt);bMap.panPnl.addControls(bMap.panCnt);$("div.olControlPanPanel").appendTo("div#pan-panel");$("div.olControlPanPanel>div").css({display:"block",position:"relative",top:"-10px",left:"-5px","margin-top":"14px","border-radius":"10px","min-width":"70px","min-height":"70px",border:"2px solid #499460","background-position":"0px 0px",cursor:"default","background-image":bVars.brwsPref+"linear-gradient(-90deg, #2e9d40, #00652e)"}).append("<div class='pan-cnt-icon'></div>");$("div.pan-cnt-icon").css({display:"inline-block",width:"100%",height:"100%","background-repeat":"no-repeat","background-position":"center center"});$("div.pan-cnt-icon:eq(0)").css("background-image",addrUrl.getImage("tr_up_mod"));$("div.pan-cnt-icon:eq(1)").css("background-image",addrUrl.getImage("tr_down_mod"));$("div.pan-cnt-icon:eq(2)").css("background-image",addrUrl.getImage("tr_right_mod"));$("div.pan-cnt-icon:eq(3)").css("background-image",addrUrl.getImage("tr_left_mod"))};uBody.goFullscreen=function(){$("html, body").animate({scrollTop:0},0).css("overflow","hidden");if(bMap.map.getZoom()<3){bMap.map.zoomTo(3)}$("div.go-fscr").hide();$("div.leave-fscr").show().on("mousedown",uBody.leaveFullcsreen);$("div#smap").css({position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%","z-index":"18"});$("div#scl-cnt").css({top:"15px",left:"30px","z-index":"19"});bMap.map.updateSize()};uBody.leaveFullcsreen=function(){if($("div.leave-fscr").is(":hidden")){return false}$("div.go-fscr").show();$("div.leave-fscr").hide().off("click");$("div#smap").removeAttr("style");$("div#scl-cnt").removeAttr("style");bMap.map.updateSize()};uBody.showStandByStores=function(){bVars.pmType=3;$.getJSON(addrUrl.getStandBySt(),function(a){if(a){uBody.showSpm(a,true)}else{return false}})};uBody.clsVKbd=function(){$("div.total-pb-bckgr").off("mousedown");uBody.togglePB()};uBody.vKbd=function(){$("textarea#sch-area-txt").keyboard({layout:"qwerty-russian",customLayout:{"default":["ё 1 2 3 4 5 6 7 8 9 0 - = {bksp}","й ц у к е н г ш щ з х ъ \\","ф ы в а п р о л д ж э","{shift} я ч с м и т ь б ю . {shift}","{cancel} {alt} {space} {accept} {meta1} {meta2}"],meta1:[],meta2:[],shift:['Ё ! " № ; % : ? * ( ) _ + {bksp}',"Й Ц У К Е Н Г Ш Щ З Х Ъ |","Ф Ы В А П Р О Л Д Ж Э","{shift} Я Ч С М И Т Ь Б Ю , {shift}","{cancel} {alt} {space} {accept} {meta1} {meta2}"],"alt-shift":["~ ! @ # $ % ^ & * ( ) _ + {bksp}","Q W E R T Y U I O P { } |",'A S D F G H J K L : "',"{shift} Z X C V B N M < > ? {shift}","{cancel} {alt} {space} {accept} {meta1} {meta2}"],alt:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","q w e r t y u i o p [ ] \\","a s d f g h j k l ; '","{shift} z x c v b n m , . / {shift}","{cancel} {alt} {space} {accept} {meta1} {meta2}"]},position:{of:null,my:"center top",at:"center top",at2:"center bottom"},usePreview:true,alwaysOpen:false,stayOpen:false,display:{a:"✔:",accept:"Найти:",alt:"English:",b:"←:",bksp:"\b⟵\b:",c:"✖:",cancel:"Закрыть:",clear:"C:Clear",combo:"ö:",dec:".:",e:"↵:Enter",enter:"Enter:Enter",lock:"⇪ Lock:",next:"Next",prev:"Prev",s:"⇧:",shift:"⇧:",sign:"±:",space:"",t:"⇥:",tab:"⇥ Tab:"},wheelMessage:"",css:{input:"sch-field",container:"kb-bckgr ui-widget ui-helper-clearfix",buttonDefault:"kb-btn-pass",buttonHover:"kb-btn-act",buttonAction:"kb-btn-act2",buttonDisabled:"kb-btn-pass"},autoAccept:false,lockInput:false,restrictInput:false,acceptValid:true,tabNavigation:false,enterNavigation:true,enterMod:"altKey",stopAtEnd:true,appendLocally:false,stickyShift:true,preventPaste:false,maxLength:50,repeatDelay:500,repeatRate:20,resetDefault:false,openOn:"focus",keyBinding:"mousedown",useCombos:true,initialized:function(b,a,c){},visible:function(b,a,c){uServe.moveCaret2End()},change:function(b,a,c){uServe.respiteSCS(true)},beforeClose:function(c,a,d,b){},accepted:function(b,a,c){if($("textarea#sch-area").val().length==0){a.cancel;uBody.clsVKbd()}else{bVars.pmType=2;$("div.pb-icon-cont").show();uBody.showSpm($("textarea#sch-area").val());uBody.toggleMapBtn(true)}},canceled:function(b,a,c){uBody.clsVKbd()},hidden:function(b,a,c){},switchInput:null,validate:function(c,a,d){var b=false;uBody.togglePB(true);$("div.pb-icon-cont").hide();setTimeout(function(){b=true},700);$("div.total-pb-bckgr").on("mousedown",function(){if(b){c.cancel;uBody.clsVKbd()}else{return false}});$("textarea.sch-field:eq(1)").attr("id","sch-area");uServe.detectCaret();$.get(addrUrl.getLbl(129),function(f){$("textarea.sch-field:eq(1)").attr("placeholder",f)});$("button.ui-keyboard-meta1").replaceWith("<button class='ui-keyboard-button kb-btn-pass' onclick='uServe.runCaretLeft()'>←</button>");$("button.ui-keyboard-meta2").replaceWith("<button class='ui-keyboard-button kb-btn-pass' onclick='uServe.runCaretRight()'>→</button>");return true}})};uServe.changeLang=function(a){if(bMap.varsArr.lang==a){return false}$.get(addrUrl.svapi("lang",a),function(){window.location.reload()})};uBody.langOpenClose=function(){if($("div.lang-btn").hasClass("lang-pass")){$("div.lang-btn").removeClass("lang-pass").addClass("lang-act");$("div.lang-close").on("mousedown",uBody.langOpenClose);uBody.langSwitcher=setTimeout(function(){uBody.langOpenClose()},15000)}else{if($("div.lang-btn").hasClass("lang-act")){$("div.lang-btn").removeClass("lang-act").addClass("lang-pass");$("div.lang-close").off("mousedown",uBody.langOpenClose);clearTimeout(uBody.langSwitcher)}}$("div.lang-elem").on("mousedown",function(){uServe.changeLang($(this).attr("id"))});$("div.lang-panel").slideToggle()};uBody.setUpAddCbtn=function(){$("div.add-cbtn").on("mousedown",function(){uBody.scatsWall(bVars.cat)});$("div.add-tt-btn").on("mousedown",uBody.showTTstores)};uBody.toggleAddCbtn=function(a){if(a&&$("div.add-cbtn-cont").is(":hidden")){$("div.add-cbtn-cont").show()}else{if(!a&&$("div.add-cbtn-cont").is(":visible")){$("div.add-cbtn-cont").hide()}}};bMap.clearSiMarkers=function(b){if(typeof bMap.sim=="undefined"){return}if(b){bMap.map.removeLayer(bMap.sim);delete bMap.sim;delete bVars.simSize;delete bVars.simOffset;delete bVars.simIcon;delete bMap.simArr}else{for(var a=0;a<bMap.simArr.length;a++){bMap.sim.removeMarker(bMap.simArr[a])}bMap.simArr.length=0}};bMap.showSiMarkers=function(){var a;if(typeof bMap.sim=="undefined"){bMap.sim=new OpenLayers.Layer.Markers("sim");bMap.map.addLayer(bMap.sim);bVars.simSize=new OpenLayers.Size(bVars.flagSize.w,bVars.flagSize.h);bVars.simOffset=new OpenLayers.Pixel(-(bVars.simSize.w/2),-bVars.simSize.h);bVars.simIcon=new OpenLayers.Icon(addrUrl.getCImage("flag"),bVars.simSize,bVars.simOffset);bMap.simArr=new Array}uBody.closeSi(true);bMap.clearSiMarkers();$.getJSON(addrUrl.getSi(bVars.si),function(b){$.each(b,function(c,d){a=new OpenLayers.Marker(new OpenLayers.LonLat(d.path_ox,d.path_oy),bVars.simIcon.clone());bMap.sim.addMarker(a);bMap.simArr.push(a)})})};uBody.closeSi=function(a){if(a===true){$("div.list-cont").hide();$("div.ls-cont").hide();uServe.toggleMap(true)}else{if($("div.si-cont").length>0){$("div.list-cont").remove();$("div.close-wall").off("click",uBody.closeSi)}uBody.makeSiBtnPass();bMap.clearSiMarkers(true)}};uBody.showSi=function(){bVars.slType=5;bMap.map.zoomToMaxExtent();uServe.toggleMap();uServe.toggleLsContBckgr();uBody.toggleCbtn();uBody.makeSiBtnAct();bMap.clearStore();uBody.closeMinisite(true,true,true);bMap.clearChsMarkers();bMap.clearPopupMarkers();bMap.clearBckgrIcons();bVars.ssCorrVal=0;uServe.toggleListBtn(false);uServe.resetGsNum();uBody.slTriangle(true);if(!($("div.list-cont").length>0)){$("td.mw").append("<div class='list-cont'></div>")}else{if($("div.list-cont").is(":hidden")){$("div.list-cont").show();$("div.ls-cont").show()}}uBody.toggleMapBtn(true);$.get(addrUrl.svapi("slider",bVars.slType),function(){$("div.list-cont").load(addrUrl.loadBlock("si"),function(){$("div.list-cont").css("background-image","none");$("div.close-wall").css({top:"749px",left:"1018px"});$("div.si-bckgr").on("click",function(){if(!bVars.dragCrit){bVars.si=parseInt($(this).find("div.si-btn").attr("id"));bMap.showSiMarkers();$("div.sibtn-name").text($(this).attr("title"))}});uServe.loadSlider();$("div.close-wall").on("mousedown",uBody.closeSi)})})};uBody.setOverview=function(){if(typeof bMap.mOverview!="undefined"){bMap.map.removeControl(bMap.mOverview);bMap.mOverview.destroy;delete bMap.mOverview}bMap.mOverview=new OpenLayers.Control.OverviewMap({maximized:false,autoPan:true,size:new OpenLayers.Size(380,200)});bMap.map.addControl(bMap.mOverview);var a={width:"50px",height:"50px","background-image":bVars.brwsPref+"linear-gradient(bottom , #1c4591, #00adee)","border-radius":"5px 0px 0px 5px",cursor:"default"};$("div#olControlOverviewMapMaximizeButton").css(a).append("<div class='overview-map-plus'></div>");$("div#olControlOverviewMapMaximizeButton").find("img").hide();$("div#OpenLayers_Control_minimizeDiv").css(a).append("<div class='overview-map-minus'></div>");$("div#OpenLayers_Control_minimizeDiv").find("img").hide();$("div.olControlOverviewMapElement").css("background-color","#C9E12D")};$(document).ready(function(){uServe.setBrwsPref();$.getJSON(addrUrl.vapi+"lang,dlang,wdir",function(a){bMap.varsArr=a;$.get(addrUrl.getSCName("bankers"),function(b){bMap.varsArr.bankers=parseFloat(b)})});bMap.setMap("smap");uBody.vKbd();uBody.showStandByStores();$("div.cbtn").on("mousedown",function(){var a=parseFloat($(this).attr("id"));if(uServe.inArray(a,bVars.specCat)){bMap.setPopupMarkers(a)}else{uBody.scatsWall(a)}});$("div.sibtn").on("mousedown",uBody.showSi);$("div.drum-btn").mousedown(function(){uBody.openMsgBox(124)});$("div.lott-btn").mousedown(function(){uBody.openMsgBox(124)});$("div.hot-btn").mousedown(function(){uBody.openMsgBox(124)});$("div.bann-item").mousedown(function(){var b;var a=parseFloat($(this).attr("id"));if(a==0){b=false}else{b=true}uBody.openMinisite(a,b);$("div.bann-cell").removeClass("bann-act").addClass("bann-pass");$(this).parent(".bann-cell").removeClass("bann-pass").addClass("bann-act")});$("div.go-fscr").mousedown(function(){uBody.goFullscreen()});$("div.mcoords-btn").mousedown(function(){bMap.centerMBM()});$("div.lang-btn").mousedown(function(){uBody.langOpenClose()});$("body").mousedown(function(){uServe.respiteSCS()});$("img.wall-product").live("mousedown",function(){return false});$("img.wall-zoomed").live("mousedown",function(){return false});uBody.setUpAddCbtn();uServe.screenSaver();uBody.bannRenewal()});